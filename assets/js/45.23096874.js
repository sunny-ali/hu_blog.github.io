(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{527:function(s,n,a){"use strict";a.r(n);var e=a(4),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("数据监听器可以用于监听和响应任何属性和数据字段的变化，通常会在监听到某个值的改变时去操作data中的其它属性值。")]),s._v(" "),a("h2",{attrs:{id:"在自定义组件中使用监听器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在自定义组件中使用监听器"}},[s._v("#")]),s._v(" 在自定义组件中使用监听器：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Component({\n  properties:{//监测传过来的属性\n    num: {\n      type: String,\n      observer: function(newVal, oldVal) {\n         console.log('properties-num', newVal)\n      }\n    },\n    person: {\n      type: Object,\n      observer: function(newVal, oldVal) {\n        // console.log('properties-person', newVal)\n      }\n    }\n  },\n  data: {\n    aloneVal: 0,\n    oneVal: null,\n    twoVal: null\n  },\n  observers: {//能够监测到props和data中的\n    // 监听全部 setData，每次 setData 都触发，一般用不到 '**' 监听全部\n    '**':function (val) {\n      console.log('**所有的setData变化：', val) // 此时返回的 val 值是一个包含所有data变量的对象\n    },\n    // 监听 properties 接收的值的变化\n    'num' (val) {\n      console.log('observers-num', val)\n    },\n    // 监听对象\n    'person' (val) {\n      console.log('observers-person', val)\n    },\n    // 监听对象的属性\n    'person.name' (val) {\n      console.log('observers-person.name', val)\n    },\n    // 监听子组件中单个数据的变化\n    'aloneVal' (val) {\n      console.log('aloneVal', val)\n    },\n    // 监听子组件中多个数据的变化\n    'oneVal, twoVal' (val1, val2) {\n      console.log('oneVal', val1)\n      console.log('twoVal', val2)\n    }\n  },\n  // 在组件在视图层布局完成后执行\n  ready() {\n    setInterval(()=>{\n    this.setData({\n      aloneVal:this.aloneVal+1\n      })\n    },1000)\n  },\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br")])]),a("p",[a("strong",[s._v("实现自定义组件的计算属性computed功能需要利用自定义组件扩展behavior.js")]),s._v("\nhttps://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/extend.html")]),s._v(" "),a("p",[s._v("新建一个behavior.js文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// behavior.js\nmodule.exports = Behavior({\n  lifetimes: {\n    created() {\n      this._originalSetData = this.setData // 原始 setData\n      this.setData = this._setData // 封装后的 setData\n    }\n  },\n  definitionFilter(defFields) {\n    const computed = defFields.computed || {}\n    const computedKeys = Object.keys(computed)\n    const computedCache = {}\n\n    // 计算 computed\n    const calcComputed = (scope, insertToData) => {\n      const needUpdate = {}\n      const data = defFields.data = defFields.data || {}\n\n      for (let key of computedKeys) {\n        const value = computed[key].call(scope) // 计算新值\n        if (computedCache[key] !== value) needUpdate[key] = computedCache[key] = value\n        if (insertToData) data[key] = needUpdate[key] // 直接插入到 data 中，初始化时才需要的操作\n      }\n\n      return needUpdate\n    }\n\n    // 重写 setData 方法\n    defFields.methods = defFields.methods || {}\n    defFields.methods._setData = function (data, callback) {\n      const originalSetData = this._originalSetData // 原始 setData\n      originalSetData.call(this, data, callback) // 做 data 的 setData\n      const needUpdate = calcComputed(this) // 计算 computed\n      originalSetData.call(this, needUpdate) // 做 computed 的 setData\n    }\n\n    // 初始化 computed\n    calcComputed(defFields, true) // 计算 computed\n  }\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])]),a("p",[s._v("在组件中使用:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const beh = require('./behavior.js')\nComponent({\n  behaviors: [beh],\n  data: {\n    a: 0,\n  },\n  computed: {\n    b() {\n      return this.data.a + 100\n    },\n  },\n  methods: {\n    onTap() {\n      this.setData({\n        a: ++this.data.a,\n      })\n    }\n  }\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h2",{attrs:{id:"在页面中使用数据监测"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在页面中使用数据监测"}},[s._v("#")]),s._v(" 在页面中使用数据监测：")]),s._v(" "),a("p",[s._v("1，在app.js中添加以下代码：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("//app.js\nApp({\n\n  setWatcher(page) {\n    let data = page.data; // 获取page 页面data\n    let watch = page.watch;\n    for(let i in watch){\n      let key = i.split('.'); // 将watch中的属性以'.'切分成数组\n      let nowData = data; // 将data赋值给nowData\n      let lastKey = key[key.length - 1];\n      let watchFun = watch[i].handler || watch[i]; // 兼容带handler和不带handler的两种写法\n      let deep = watch[i].deep; // 若未设置deep,则为undefine\n      this.observe(nowData, lastKey, watchFun, deep, page); // 监听nowData对象的lastKey\n      }\n  },\n\n    observe(obj, key, watchFun, deep, page) {\n      let val = obj[key];\n      // 判断deep是true 且 val不能为空 且 typeof val==='object'（数组内数值变化也需要深度监听）\n      if (deep && val != null && typeof val === 'object') {\n      for(let i in val){\n      this.observe(val, i, watchFun, deep, page); // 递归调用监听函数\n    }\n  }\n    let that = this;\n    Object.defineProperty(obj, key, {\n    configurable: true,\n    enumerable: true,\n    set: function (value) {\n      // 用page对象调用,改变函数内this指向,以便this.data访问data内的属性值\n      watchFun.call(page, value, val); // value是新值，val是旧值\n      val = value;\n      if (deep) { // 若是深度监听,重新监听该对象，以便监听其属性。\n       that.observe(obj, key, watchFun, deep, page);\n      }\n    },\n    get: function () {\n     return val;\n    }\n    })\n  }\n\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br")])]),a("p",[s._v("2，在页面index.js中使用：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// pages/index/index.js\nimport initComputed from '../../lib/wxComputed.min.js'// 引入computed属性方法\nconst app = getApp()\nPage({\ndata:{\n  createProcesDescribe:'',\n  createProcesName: '',\n  lastName: 'aa',\n  firstName: 'bb',\n},\n\n   onLoad(option){//监听页面加载\n    app.setWatcher(this)// 设置监听器,建议在onload里设置\n    \n    initComputed(this)//执行computed属性初始化\n   },\n   \n  // computed属性\n  computed: {\n    // 这是一个函数，返回值为此计算属性的值\n    fullName() {\n        return this.data.lastName + '-' + this.data.firstName\n    },\n  },\n  \n  //watch监听data里的数据\n   watch:{\n    createProcesName:{\n      handler(newVal,oldVal){\n        console.log(newVal,oldVal)\n      }\n    },\n    createProcesDescribe:{\n      handler(newVal,oldVal){\n        console.log(newVal,oldVal)\n    },\n  },\n })\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("p",[a("strong",[s._v("总结")]),s._v("：在自定义组件中直接使用observers其实跟Vue框架中使用watch作用一样，如果在自定义组件中使用computed属性功能则需要引入组件扩展。在页面中使用watch也需要自己在外部添加监听方法，然后在需要监听的页面中引入监听器，并设置监听器，如果在页面中需要使用计算属性computed也需要在页面中引入该功能文件。")])])}),[],!1,null,null,null);n.default=t.exports}}]);